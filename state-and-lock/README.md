# Introduction

Create the Tf S3 and DynamoDB to save the tfstate file and lock to don't run simultaneously

# Motivation

To work as a team, and to the CI/CD is important to save the tfstate file of each environment

To work with the team, is important create a lock beatween everyone to noone run as same time the cloudformation, but create a pipeline is the best option

# How to do

To save the state on S3 and use the dynamodb as lock, see the file tf-backend.tf and outputs.tf

Edit the terraform.tfvars with the necessary configurations. See the information of module: [cloudposse/tfstate-backend](https://registry.terraform.io/modules/cloudposse/tfstate-backend/aws/latest)

```
code terraform.tfvars
```

Run the apply for this resource to create the TF backend file

```
terraform apply
```

After runned it, verify your backend.tf file

```
cat backend.tf
```

After verify the configuration, copy the file generated by the module to the main project

```
cp backend.tf ../
sed -i "s#profile[[:space:]]*= \"\"##g" ../backend.tf
sed -i "s#role_arn[[:space:]]*= \"\"##g" ../backend.tf
```

On the main project, run the init again to load the configuration

```
cd ../
terraform init -force-copy
```
